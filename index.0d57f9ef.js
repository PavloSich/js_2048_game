const t=new class{constructor(t){this.initialState=t?t.map(t=>[...t]):[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]].map(t=>[...t]),this.state=this.initialState.map(t=>[...t]),this.score=0,this.status="idle"}getState(){return this.state.map(t=>[...t])}getScore(){return this.score}getStatus(){return this.status}start(){"idle"===this.status&&(this.status="playing",this.addRandomTile(),this.addRandomTile())}restart(){this.state=this.initialState.map(t=>[...t]),this.score=0,this.status="idle"}moveLeft(){this.applyMove(t=>t)}moveRight(){this.applyMove(t=>[...t].reverse())}moveUp(){this.transpose(),this.applyMove(t=>t),this.transpose()}moveDown(){this.transpose(),this.applyMove(t=>[...t].reverse()),this.transpose()}applyMove(t){if("playing"!==this.status)return;let e=JSON.stringify(this.state),s=0;this.state=this.state.map(e=>{let a=t([...e]),{newRow:r,score:i}=this.mergeRow(a);return s+=i,t(r)}),JSON.stringify(this.state)!==e&&(this.score+=s,this.addRandomTile(),this.updateStatus())}mergeRow(t){let e=t.filter(Boolean),s=[],a=0;for(let t=0;t<e.length;t++)if(e[t]===e[t+1]){let r=2*e[t];s.push(r),a+=r,t++}else s.push(e[t]);for(;s.length<4;)s.push(0);return{newRow:s,score:a}}addRandomTile(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push({r:e,c:s});if(!t.length)return;let{r:e,c:s}=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}transpose(){let t=[];for(let e=0;e<4;e++){t[e]=[];for(let s=0;s<4;s++)t[e][s]=this.state[s][e]}this.state=t}updateStatus(){if(this.state.flat().includes(2048)){this.status="win";return}this.hasMoves()||(this.status="lose")}hasMoves(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(0===s||e<3&&s===this.state[t][e+1]||t<3&&s===this.state[t+1][e])return!0}return!1}},e=Array.from(document.querySelectorAll(".field-cell")),s=document.querySelector(".game-score"),a=document.querySelector(".button"),r=document.querySelector(".message-start"),i=document.querySelector(".message-win"),o=document.querySelector(".message-lose");function l(){let a=t.getState();e.forEach((t,e)=>{let s=a[Math.floor(e/4)][e%4];t.className="field-cell",t.textContent=s||"",s&&t.classList.add(`field-cell--${s}`)}),s.textContent=t.getScore(),r.classList.add("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),"win"===t.getStatus()&&i.classList.remove("hidden"),"lose"===t.getStatus()&&o.classList.remove("hidden")}a.addEventListener("click",()=>{"idle"===t.getStatus()?(t.start(),a.textContent="Restart",a.classList.remove("start"),a.classList.add("restart")):(t.restart(),a.textContent="Start",a.classList.remove("restart"),a.classList.add("start")),l()}),document.addEventListener("keydown",e=>{"playing"===t.getStatus()&&("ArrowLeft"===e.key&&t.moveLeft(),"ArrowRight"===e.key&&t.moveRight(),"ArrowUp"===e.key&&t.moveUp(),"ArrowDown"===e.key&&t.moveDown(),l())}),l();
//# sourceMappingURL=index.0d57f9ef.js.map
